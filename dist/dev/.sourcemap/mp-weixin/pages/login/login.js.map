{"version":3,"sources":["uni-app:///src/main.js","webpack:///./src/pages/login/login.vue?f019","webpack:///./src/pages/login/login.vue?739f","webpack:///./src/pages/login/login.vue?7c07","webpack:///./src/pages/login/login.vue?df4e","uni-app:///src/pages/login/login.vue","webpack:///./src/pages/login/login.vue?50da"],"names":["createPage","Page","renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","_isMounted","e0","$event","index","_temp","arguments","length","currentTarget","dataset","_temp2","eventParams","loginType","recyclableRender","staticRenderFns","_withStripped","deviceId","scene","mInput","data","platform","uni","getSystemInfoSync","loginTypeList","mobile","code","providerList","hasProvider","username","password","positionTop","isDevtools","codeDuration","loginBtnLoading","hasAppleLogin","needCaptcha","getStorageSync","captchaing","captchaBase64","captchaText","computed","onLoad","captcha","methods","initProvider","getProvider","service","success","res","provider","indexOf","filters","curProvider","value","image","fail","initPosition","windowHeight","sendSmsCode","showModal","content","showCancel","test","uniCloud","callFunction","name","action","params","type","e","result","clearInterval","msg","loginBySms","setStorageSync","token","JSON","stringify","title","bindLogin","loginByPwd","oauth","Promise","login","resolve","reject","Error","getUserInfo","detail","userInfo","loginLocal","nickName","showToast","icon","toMain","userName","reLaunch","url","toLogin","complete","err","loginByWeixin","loginByApple","openAppleLoginDoc","onReady"],"mappings":"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","file":"pages/login/login.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/login/login.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./login.vue?vue&type=template&id=b237504c&\"\nvar renderjs\nimport script from \"./login.vue?vue&type=script&lang=js&\"\nexport * from \"./login.vue?vue&type=script&lang=js&\"\nimport style0 from \"./login.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/login/login.vue\"\nexport default component.exports","export * from \"-!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--14-0!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./login.vue?vue&type=template&id=b237504c&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  if (!_vm._isMounted) {\n    _vm.e0 = function($event, index) {\n      var _temp = arguments[arguments.length - 1].currentTarget.dataset,\n        _temp2 = _temp.eventParams || _temp[\"event-params\"],\n        index = _temp2.index\n\n      var _temp, _temp2\n\n      _vm.loginType = index\n    }\n  }\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./login.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--12-1!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./login.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"content\">\r\n    <view class=\"login-type\">\r\n      <view\r\n        v-for=\"(item, index) in loginTypeList\"\r\n        :key=\"index\"\r\n        @click=\"loginType = index\"\r\n        :class=\"{ act: loginType === index }\"\r\n        class=\"login-type-btn\"\r\n        >{{ item }}</view\r\n      >\r\n    </view>\r\n    <view class=\"input-group\" v-if=\"loginType === 0\">\r\n      <view class=\"input-row border\">\r\n        <text class=\"title\">手机：</text>\r\n        <m-input\r\n          class=\"m-input\"\r\n          type=\"text\"\r\n          clearable\r\n          focus\r\n          v-model=\"mobile\"\r\n          placeholder=\"请输入手机号码\"\r\n        ></m-input>\r\n      </view>\r\n      <view class=\"input-row\">\r\n        <text class=\"title\">验证码：</text>\r\n        <m-input\r\n          type=\"text\"\r\n          v-model=\"code\"\r\n          placeholder=\"请输入验证码\"\r\n        ></m-input>\r\n        <view class=\"send-code-btn\" @click=\"sendSmsCode\">{{\r\n          codeDuration ? codeDuration + \"s\" : \"发送验证码\"\r\n        }}</view>\r\n      </view>\r\n    </view>\r\n    <view class=\"input-group\" v-else>\r\n      <view class=\"input-row border\">\r\n        <text class=\"title\">账号：</text>\r\n        <m-input\r\n          class=\"m-input\"\r\n          type=\"text\"\r\n          clearable\r\n          focus\r\n          v-model=\"username\"\r\n          placeholder=\"请输入账号\"\r\n        ></m-input>\r\n      </view>\r\n      <view class=\"input-row border\">\r\n        <text class=\"title\">密码：</text>\r\n        <m-input\r\n          type=\"password\"\r\n          displayable\r\n          v-model=\"password\"\r\n          placeholder=\"请输入密码\"\r\n        ></m-input>\r\n      </view>\r\n      <view v-if=\"needCaptcha\" class=\"input-row\">\r\n        <text class=\"title\">验证码：</text>\r\n        <m-input\r\n          type=\"text\"\r\n          v-model=\"captchaText\"\r\n          placeholder=\"请输入验证码\"\r\n        ></m-input>\r\n        <view\r\n          class=\"send-code-btn captcha-view\"\r\n          @click=\"captcha('refreshCaptcha')\"\r\n        >\r\n          <i v-if=\"captchaing\" class=\"uni-icon_toast uni-loading\"></i>\r\n          <img\r\n            v-if=\"!captchaing\"\r\n            :src=\"captchaBase64\"\r\n            width=\"100%\"\r\n            height=\"100%\"\r\n          />\r\n        </view>\r\n      </view>\r\n    </view>\r\n    <view class=\"btn-row\">\r\n      <button\r\n        type=\"primary\"\r\n        class=\"primary\"\r\n        :loading=\"loginBtnLoading\"\r\n        @tap=\"bindLogin\"\r\n      >\r\n        登录\r\n      </button>\r\n    </view>\r\n    <view class=\"action-row\">\r\n      <navigator url=\"../reg/reg\">注册账号</navigator>\r\n    </view>\r\n    <view\r\n      class=\"oauth-row\"\r\n      v-if=\"hasProvider\"\r\n      v-bind:style=\"{ top: positionTop + 'px' }\"\r\n    >\r\n      <view\r\n        class=\"oauth-image\"\r\n        v-for=\"provider in providerList\"\r\n        :key=\"provider.value\"\r\n      >\r\n        <image :src=\"provider.image\" @tap=\"toLogin(provider.value)\"></image>\r\n        <!-- #ifdef MP-WEIXIN -->\r\n        <button\r\n          v-if=\"!isDevtools\"\r\n          open-type=\"getUserInfo\"\r\n          @getuserinfo=\"getUserInfo\"\r\n        ></button>\r\n        <!-- #endif -->\r\n      </view>\r\n    </view>\r\n    <view\r\n      class=\"oauth-row\"\r\n      v-if=\"hasProvider && !hasAppleLogin && platform === 'ios'\"\r\n      v-bind:style=\"{ top: positionTop - 50 + 'px' }\"\r\n    >\r\n      <text style=\"color: #C8C7CC;text-align: center;\"\r\n        >暂无法使用苹果登录，请查阅&nbsp;&nbsp;\r\n        <text\r\n          style=\"color: #C8C7CC;text-decoration: underline;\"\r\n          @click=\"openAppleLoginDoc\"\r\n          >Apple登录集成教程</text\r\n        >\r\n      </text>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nimport { mapState, mapMutations } from \"vuex\";\r\nimport mInput from \"../../components/m-input.vue\";\r\nimport { univerifyLogin, univerifyErrorHandler } from \"@/common/univerify.js\";\r\nimport { getDeviceUUID } from \"@/common/utils.js\";\r\n\r\nlet weixinAuthService;\r\nconst captchaOptions = {\r\n  deviceId: getDeviceUUID(),\r\n  scene: \"login\"\r\n};\r\n\r\nexport default {\r\n  components: {\r\n    mInput\r\n  },\r\n  data() {\r\n    return {\r\n      platform: uni.getSystemInfoSync().platform,\r\n      loginType: 0,\r\n      loginTypeList: [\"免密登录\", \"密码登录\"],\r\n      mobile: \"\",\r\n      code: \"\",\r\n      providerList: [],\r\n      hasProvider: false,\r\n      username: \"\",\r\n      password: \"\",\r\n      positionTop: 0,\r\n      isDevtools: false,\r\n      codeDuration: 0,\r\n      loginBtnLoading: false,\r\n      hasAppleLogin: false,\r\n      needCaptcha: uni.getStorageSync(\"uni-needCaptcha\"),\r\n      captchaing: false,\r\n      captchaBase64: \"\",\r\n      captchaText: \"\"\r\n    };\r\n  },\r\n  computed: mapState([\r\n    \"forcedLogin\",\r\n    \"hasLogin\",\r\n    \"univerifyErrorMsg\",\r\n    \"hideUniverify\"\r\n  ]),\r\n  onLoad() {\r\n    // #ifdef APP-PLUS\r\n    plus.oauth.getServices(services => {\r\n      weixinAuthService = services.find(service => {\r\n        return service.id === \"weixin\";\r\n      });\r\n      if (weixinAuthService) {\r\n        this.hasWeixinAuth = true;\r\n      }\r\n    });\r\n    // #endif\r\n    if (this.needCaptcha) {\r\n      this.captcha(\"createCaptcha\");\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapMutations([\"login\"]),\r\n    initProvider() {\r\n      const filters = [\"weixin\", \"qq\", \"sinaweibo\", \"univerify\"];\r\n      uni.getProvider({\r\n        service: \"oauth\",\r\n        success: res => {\r\n          if (res.provider && res.provider.length) {\r\n            if (res.provider.indexOf(\"apple\") !== -1) {\r\n              this.hasAppleLogin = true;\r\n            }\r\n            for (let i = 0; i < res.provider.length; i++) {\r\n              const curProvider = res.provider[i];\r\n              if (~filters.indexOf(curProvider)) {\r\n                this.providerList.push({\r\n                  value: curProvider,\r\n                  image: \"../../static/img/\" + curProvider + \".png\"\r\n                });\r\n              }\r\n            }\r\n            this.hasProvider = true;\r\n          }\r\n        },\r\n        fail: err => {\r\n          console.error(\"获取服务供应商失败：\" + JSON.stringify(err));\r\n        }\r\n      });\r\n    },\r\n    initPosition() {\r\n      /**\r\n       * 使用 absolute 定位，并且设置 bottom 值进行定位。软键盘弹出时，底部会因为窗口变化而被顶上来。\r\n       * 反向使用 top 进行定位，可以避免此问题。\r\n       */\r\n      this.positionTop = uni.getSystemInfoSync().windowHeight - 100;\r\n    },\r\n    sendSmsCode() {\r\n      if (this.codeDuration) {\r\n        uni.showModal({\r\n          content: `请在${this.codeDuration}秒后重试`,\r\n          showCancel: false\r\n        });\r\n      }\r\n      if (!/^1\\d{10}$/.test(this.mobile)) {\r\n        uni.showModal({\r\n          content: \"手机号码填写错误\",\r\n          showCancel: false\r\n        });\r\n        return;\r\n      }\r\n      uniCloud.callFunction({\r\n        name: \"user-center\",\r\n        data: {\r\n          action: \"sendSmsCode\",\r\n          params: {\r\n            mobile: this.mobile,\r\n            type: \"login\"\r\n          }\r\n        },\r\n        success: e => {\r\n          if (e.result.code == 0) {\r\n            uni.showModal({\r\n              content: \"验证码发送成功，请注意查收\",\r\n              showCancel: false\r\n            });\r\n            this.codeDuration = 60;\r\n            this.codeInterVal = setInterval(() => {\r\n              this.codeDuration--;\r\n              if (this.codeDuration === 0) {\r\n                if (this.codeInterVal) {\r\n                  clearInterval(this.codeInterVal);\r\n                  this.codeInterVal = null;\r\n                }\r\n              }\r\n            }, 1000);\r\n          } else {\r\n            uni.showModal({\r\n              content: \"验证码发送失败：\" + e.result.msg,\r\n              showCancel: false\r\n            });\r\n          }\r\n        },\r\n        fail(e) {\r\n          uni.showModal({\r\n            content: \"验证码发送失败\",\r\n            showCancel: false\r\n          });\r\n        }\r\n      });\r\n    },\r\n    async loginByPwd() {\r\n      /**\r\n       * 客户端对账号信息进行一些必要的校验。\r\n       * 实际开发中，根据业务需要进行处理，这里仅做示例。\r\n       */\r\n      if (this.username.length < 3) {\r\n        uni.showToast({\r\n          icon: \"none\",\r\n          title: \"账号最短为 3 个字符\"\r\n        });\r\n        return;\r\n      }\r\n      if (this.password.length < 6) {\r\n        uni.showToast({\r\n          icon: \"none\",\r\n          title: \"密码最短为 6 个字符\"\r\n        });\r\n        return;\r\n      }\r\n      const data = {\r\n        username: this.username,\r\n        password: this.password,\r\n        captcha: this.captchaText,\r\n        ...captchaOptions\r\n      };\r\n      this.loginBtnLoading = true;\r\n      uniCloud.callFunction({\r\n        name: \"user-center\",\r\n        data: {\r\n          action: \"login\",\r\n          params: data\r\n        },\r\n        success: e => {\r\n          if (e.result.code == 0) {\r\n            this.needCaptcha = false;\r\n            uni.setStorageSync(\"uni-needCaptcha\", this.needCaptcha);\r\n\r\n            uni.setStorageSync(\"uni_id_token\", e.result.token);\r\n            uni.setStorageSync(\"username\", e.result.username);\r\n            uni.setStorageSync(\"login_type\", \"online\");\r\n            uni.setStorageSync(\"uni_id_has_pwd\", true);\r\n            this.toMain(this.username);\r\n          } else {\r\n            uni.showModal({\r\n              content: e.result.message,\r\n              showCancel: false\r\n            });\r\n\r\n            this.needCaptcha = e.result.needCaptcha;\r\n            uni.setStorageSync(\"uni-needCaptcha\", this.needCaptcha);\r\n            if (this.needCaptcha) {\r\n              this.captcha(\"createCaptcha\");\r\n            }\r\n          }\r\n        },\r\n        fail: e => {\r\n          uni.showModal({\r\n            content: JSON.stringify(e),\r\n            showCancel: false\r\n          });\r\n        },\r\n        complete: () => {\r\n          this.loginBtnLoading = false;\r\n        }\r\n      });\r\n    },\r\n    loginBySms() {\r\n      if (!/^1\\d{10}$/.test(this.mobile)) {\r\n        uni.showModal({\r\n          content: \"手机号码填写错误\",\r\n          showCancel: false\r\n        });\r\n        return;\r\n      }\r\n      if (!/^\\d{6}$/.test(this.code)) {\r\n        uni.showModal({\r\n          title: \"验证码为6位纯数字\",\r\n          showCancel: false\r\n        });\r\n        return;\r\n      }\r\n\r\n      uniCloud.callFunction({\r\n        name: \"user-center\",\r\n        data: {\r\n          action: \"loginBySms\",\r\n          params: {\r\n            mobile: this.mobile,\r\n            code: this.code\r\n          }\r\n        },\r\n        success: e => {\r\n          console.log(\"login success\", e);\r\n\r\n          if (e.result.code == 0) {\r\n            const username = e.result.username || \"新用户\";\r\n            uni.setStorageSync(\"uni_id_token\", e.result.token);\r\n            uni.setStorageSync(\"username\", username);\r\n            uni.setStorageSync(\"login_type\", \"online\");\r\n            this.toMain(username);\r\n          } else {\r\n            uni.showModal({\r\n              content: e.result.msg,\r\n              showCancel: false\r\n            });\r\n            console.log(\"登录失败\", e);\r\n          }\r\n        },\r\n        fail(e) {\r\n          uni.showModal({\r\n            content: JSON.stringify(e),\r\n            showCancel: false\r\n          });\r\n        }\r\n      });\r\n    },\r\n    bindLogin() {\r\n      switch (this.loginType) {\r\n        case 0:\r\n          this.loginBySms();\r\n          break;\r\n        case 1:\r\n          this.loginByPwd();\r\n          break;\r\n        default:\r\n          break;\r\n      }\r\n    },\r\n    oauth(value) {\r\n      return new Promise((resolve, reject) => {\r\n        // #ifdef APP-PLUS\r\n        weixinAuthService.authorize(\r\n          function(res) {\r\n            resolve(res.code);\r\n          },\r\n          function(err) {\r\n            console.error(err);\r\n            reject(new Error(\"微信登录失败\"));\r\n          }\r\n        );\r\n        // #endif\r\n        // #ifdef MP-WEIXIN\r\n        uni.login({\r\n          provider: \"weixin\",\r\n          success(res) {\r\n            resolve(res.code);\r\n          },\r\n          fail(err) {\r\n            console.error(\"授权登录失败：\" + JSON.stringify(err));\r\n            reject(new Error(\"微信登录失败\"));\r\n          }\r\n        });\r\n        // #endif\r\n      });\r\n    },\r\n    getUserInfo({ detail }) {\r\n      console.log(\"三方登录只演示登录api能力，暂未关联云端数据\");\r\n      if (detail.userInfo) {\r\n        this.loginLocal(detail.userInfo.nickName);\r\n      } else {\r\n        uni.showToast({\r\n          icon: \"none\",\r\n          title: \"登陆失败\"\r\n        });\r\n      }\r\n    },\r\n    loginLocal(nickName) {\r\n      uni.setStorageSync(\"login_type\", \"local\");\r\n      uni.setStorageSync(\"username\", nickName);\r\n      this.toMain(nickName);\r\n    },\r\n    toMain(userName) {\r\n      this.login(userName);\r\n      /**\r\n       * 强制登录时使用reLaunch方式跳转过来\r\n       * 返回首页也使用reLaunch方式\r\n       */\r\n      uni.reLaunch({\r\n        url: \"../main/main\"\r\n      });\r\n    },\r\n    toLogin(value) {\r\n      if (value === \"apple\") {\r\n        this.loginByApple(value);\r\n        return;\r\n      }\r\n      if (value === \"weixin\") {\r\n        this.loginByWeixin(value);\r\n        return;\r\n      }\r\n      if (value === \"univerify\") {\r\n        univerifyLogin().catch(err => {\r\n          if (typeof err === \"boolean\") return;\r\n          univerifyErrorHandler(err);\r\n        });\r\n        return;\r\n      }\r\n      uni.showModal({\r\n        content: `${value}登录只演示登录api能力，暂未关联云端数据`,\r\n        showCancel: false,\r\n        complete: () => {\r\n          console.log(`${value}登录只演示登录api能力，暂未关联云端数据`);\r\n          uni.login({\r\n            provider: value,\r\n            success: res => {\r\n              uni.getUserInfo({\r\n                provider: value,\r\n                success: infoRes => {\r\n                  /**\r\n                   * 实际开发中，获取用户信息后，需要将信息上报至服务端。\r\n                   * 服务端可以用 userInfo.openId 作为用户的唯一标识新增或绑定用户信息。\r\n                   */\r\n                  this.loginLocal(infoRes.userInfo.nickName);\r\n                },\r\n                fail() {\r\n                  uni.showToast({\r\n                    icon: \"none\",\r\n                    title: \"登陆失败\"\r\n                  });\r\n                }\r\n              });\r\n            },\r\n            fail: err => {\r\n              console.error(\"授权登录失败：\" + JSON.stringify(err));\r\n            }\r\n          });\r\n        }\r\n      });\r\n    },\r\n    loginByWeixin(value) {\r\n      this.oauth(value)\r\n        .then(code => {\r\n          return uniCloud.callFunction({\r\n            name: \"user-center\",\r\n            data: {\r\n              action: \"loginByWeixin\",\r\n              params: {\r\n                code\r\n              }\r\n            }\r\n          });\r\n        })\r\n        .then(res => {\r\n          if (res.result.code === 0) {\r\n            uni.setStorageSync(\"uni_id_token\", res.result.token);\r\n            uni.setStorageSync(\"uni_id_token_expired\", res.result.tokenExpired);\r\n            uni.setStorageSync(\"login_type\", \"online\");\r\n            uni.setStorageSync(\"username\", \"微信用户\");\r\n            this.toMain(\"微信用户\");\r\n          }\r\n        })\r\n        .catch(e => {\r\n          console.error(e);\r\n          uni.showModal({\r\n            showCancel: false,\r\n            content: \"微信登录失败，请稍后再试\"\r\n          });\r\n        });\r\n    },\r\n    async loginByApple(value) {\r\n      if (!this.hasAppleLogin) {\r\n        uni.showModal({\r\n          showCancel: false,\r\n          content: `暂无法使用苹果登录，Apple登录集成教程：\\nhttps://ask.dcloud.net.cn/article/36651`\r\n        });\r\n        return;\r\n      }\r\n      let Provider = value;\r\n      const [loginErr, loginData] = await uni.login({\r\n        provider: Provider\r\n      });\r\n      if (loginErr) {\r\n        uni.showModal({\r\n          showCancel: false,\r\n          content: \"苹果登录失败，请稍后再试\"\r\n        });\r\n        return;\r\n      }\r\n      // 获取用户信息\r\n      const [getUserInfoErr, result] = await uni.getUserInfo({\r\n        provider: Provider\r\n      });\r\n      if (getUserInfoErr) {\r\n        let content = getUserInfoErr.errMsg;\r\n        if (~content.indexOf(\"uni.login\")) {\r\n          content = \"请先完成登录操作\";\r\n        }\r\n        uni.showModal({\r\n          title: \"获取用户信息失败\",\r\n          content: \"错误原因\" + content,\r\n          showCancel: false\r\n        });\r\n        return;\r\n      }\r\n      // uni-id 苹果登录\r\n      uniCloud.callFunction({\r\n        name: \"user-center\",\r\n        data: {\r\n          action: \"loginByApple\",\r\n          params: result.userInfo\r\n        },\r\n        success: e => {\r\n          console.log(\"loginByApple success\", e);\r\n          if (!e.success) {\r\n            uni.showModal({\r\n              showCancel: false,\r\n              content: JSON.stringify(e.message)\r\n            });\r\n            return;\r\n          }\r\n          const username = e.result.username || e.result.nickname;\r\n\r\n          uni.setStorageSync(\"uni_id_token\", e.result.token);\r\n          uni.setStorageSync(\"login_type\", \"online\");\r\n\r\n          this.toMain(username);\r\n        },\r\n        fail: e => {\r\n          uni.showModal({\r\n            content: `苹果登录失败: ${JSON.stringify(e)}`,\r\n            showCancel: false\r\n          });\r\n        }\r\n      });\r\n    },\r\n    async captcha(action, args) {\r\n      if (this.captchaing) return;\r\n\r\n      // 验证不loading\r\n      this.captchaing = true;\r\n\r\n      let { result: res } = await uniCloud.callFunction({\r\n        name: \"user-center\",\r\n        data: {\r\n          action,\r\n          params: {\r\n            ...captchaOptions,\r\n            ...args\r\n          }\r\n        }\r\n      });\r\n      this.captchaing = false;\r\n      if (res.code === 0) {\r\n        this.captchaBase64 = res.captchaBase64;\r\n      } else {\r\n        uni.showToast({\r\n          icon: \"none\",\r\n          title: res.message,\r\n          duration: 1000\r\n        });\r\n      }\r\n      return res;\r\n    },\r\n    openAppleLoginDoc() {\r\n      // #ifdef APP-PLUS\r\n      plus.webview.open(\"https://ask.dcloud.net.cn/article/36651\");\r\n      // #endif\r\n    }\r\n  },\r\n  onReady() {\r\n    this.initPosition();\r\n    this.initProvider();\r\n    // #ifdef MP-WEIXIN\r\n    this.isDevtools = uni.getSystemInfoSync().platform === \"devtools\";\r\n    // #endif\r\n  }\r\n};\r\n</script>\r\n\r\n<style>\r\n.login-type {\r\n  display: flex;\r\n  justify-content: center;\r\n}\r\n\r\n.login-type-btn {\r\n  line-height: 30px;\r\n  margin: 0px 15px;\r\n}\r\n\r\n.login-type-btn.act {\r\n  color: #0faeff;\r\n  border-bottom: solid 1px #0faeff;\r\n}\r\n\r\n.send-code-btn {\r\n  width: 120px;\r\n  text-align: center;\r\n  background-color: #0faeff;\r\n  color: #ffffff;\r\n}\r\n\r\n.action-row {\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n}\r\n\r\n.action-row navigator {\r\n  color: #007aff;\r\n  padding: 0 10px;\r\n}\r\n\r\n.oauth-row {\r\n  display: flex;\r\n  flex-direction: row;\r\n  align-items: center;\r\n  justify-content: space-around;\r\n  flex-wrap: wrap;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  width: 100%;\r\n}\r\n\r\n.oauth-image {\r\n  position: relative;\r\n  width: 50px;\r\n  height: 50px;\r\n  border: 1px solid #dddddd;\r\n  border-radius: 50px;\r\n  background-color: #ffffff;\r\n}\r\n\r\n.oauth-image image {\r\n  width: 30px;\r\n  height: 30px;\r\n  margin: 10px;\r\n}\r\n\r\n.oauth-image button {\r\n  position: absolute;\r\n  left: 0;\r\n  top: 0;\r\n  width: 100%;\r\n  height: 100%;\r\n  opacity: 0;\r\n}\r\n\r\n.captcha-view {\r\n  line-height: 0;\r\n  justify-content: center;\r\n  align-items: center;\r\n  display: flex;\r\n  position: relative;\r\n  background-color: #f3f3f3;\r\n}\r\n</style>\r\n","import mod from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./login.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--6-oneOf-1-2!../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-3!../../../node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./login.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}